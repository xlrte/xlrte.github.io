"use strict";(self.webpackChunkxlrte_dev=self.webpackChunkxlrte_dev||[]).push([[165],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),u=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return o.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},l=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),l=u(n),m=r,b=l["".concat(c,".").concat(m)]||l[m]||d[m]||a;return n?o.createElement(b,i(i({ref:t},p),{},{components:n})):o.createElement(b,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=l;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}l.displayName="MDXCreateElement"},8391:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return u},toc:function(){return p},default:function(){return l}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),i=["components"],s={sidebar_position:7},c="Add a Pub/Sub topic",u={unversionedId:"getting-started/add-a-pubsub-topic",id:"getting-started/add-a-pubsub-topic",isDocsHomePage:!1,title:"Add a Pub/Sub topic",description:"We assume you already added the depends_on block to your service yaml in the previous page (if not, go back at least to see where it fits).",source:"@site/docs/getting-started/add-a-pubsub-topic.md",sourceDirName:"getting-started",slug:"/getting-started/add-a-pubsub-topic",permalink:"/docs/getting-started/add-a-pubsub-topic",editUrl:"https://github.com/xlrte/website/edit/main/docs/getting-started/add-a-pubsub-topic.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Add a database",permalink:"/docs/getting-started/add-a-database"},next:{title:"Add a Cloud Storage bucket",permalink:"/docs/getting-started/add-a-storage-bucket"}},p=[{value:"what does <code>owner</code> do?",id:"what-does-owner-do",children:[],level:3}],d={toc:p};function l(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"add-a-pubsub-topic"},"Add a Pub/Sub topic"),(0,a.kt)("p",null,"We assume you already added the ",(0,a.kt)("inlineCode",{parentName:"p"},"depends_on")," block to your service yaml in the previous page (if not, go back at least to see where it fits)."),(0,a.kt)("p",null,"To add Pub/Sub topics, you could add this to the ",(0,a.kt)("inlineCode",{parentName:"p"},"depends_on")," block of your service yaml:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"  pubsub:\n    consume:\n    - name: some_topic\n      owner: true\n    produce:\n    - name: other_topic\n")),(0,a.kt)("p",null,"On the next apply, this would do the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Create ",(0,a.kt)("inlineCode",{parentName:"li"},"some_topic"),", a subscription to said topic and bind an IAM permission to your service that allows it to receive push messages from the subscription (Cloud Run only supports Pub/Sub push for now in GCP). Messages are ",(0,a.kt)("inlineCode",{parentName:"li"},"POST"),"ed to ",(0,a.kt)("inlineCode",{parentName:"li"},"/")," of your service."),(0,a.kt)("li",{parentName:"ul"},"Create ",(0,a.kt)("inlineCode",{parentName:"li"},"other_topic"),", and bind an IAM permission that allows your service to publish to the topic.")),(0,a.kt)("h3",{id:"what-does-owner-do"},"what does ",(0,a.kt)("inlineCode",{parentName:"h3"},"owner")," do?"),(0,a.kt)("p",null,'The owner property is specific to topics we consume from and optional. We assume that a publisher to a topic always "owns" the topic. This is the semantics we want in most cases, so if you define two services that depend on the same topic, one that produces and one that consumes, you need not worry about this property. Everything will "just work".'),(0,a.kt)("p",null," But there may be a small number of cases where either the real owner is external to xlrte, or we want a consumer to own the topic. In this case we define it explicitly in xlrte."),(0,a.kt)("p",null,"The reason for making topics optionally owned by consumers is so that we can control creation and destruction of topics. If a consumer does not own a topic, we only create a subscription, not the topic itself."))}l.isMDXComponent=!0}}]);